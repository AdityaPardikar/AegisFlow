services:
  # --------------------------------------------------------------------------------
  # 1. Backend Service (FastAPI)
  # --------------------------------------------------------------------------------
  - type: web
    name: aegisflow-backend
    runtime: python
    region: singapore # Optional: Choose closest
    buildCommand: |
      pip install -r backend/requirements.txt
      python backend/ml_engine/trainer.py
    startCommand: uvicorn backend.app.main:app --host 0.0.0.0 --port $PORT
    envVars:
      - key: PYTHON_VERSION
        value: 3.11.0
      - key: PYTHONPATH
        value: .
      - key: ACCESS_TOKEN_EXPIRE_MINUTES
        value: 1440
      - key: PROJECT_NAME
        value: AegisFlow
    # Database Config (For Render-managed Postgres, uncomment below lines and add database block)
    # - key: DATABASE_URL
    #   fromDatabase:
    #     name: aegisflow-db
    #     property: connectionString

  # --------------------------------------------------------------------------------
  # 2. Frontend Service (React as Web Service)
  # --------------------------------------------------------------------------------
  - type: web
    name: aegisflow-frontend
    runtime: node
    region: singapore
    buildCommand: |
      cd frontend
      npm install
      npm run build
    startCommand: cd frontend && npx serve -s dist -l $PORT
    envVars:
      - key: VITE_API_URL
        fromService:
          type: web
          name: aegisflow-backend
          envVarKey: RENDER_EXTERNAL_HOSTNAME

# Optional: Add Database
# databases:
#   - name: aegisflow-db
#     databaseName: aegisflow
#     user: aegis_user
#     plan: free
